rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Allow read access to all collections
    match /projects/{projectId} {
      allow read: if true;
      // Simplified claps update rule
      allow update: if
        request.resource.data.keys().hasOnly(resource.data.keys()) &&  // No new fields
        request.resource.data.diff(resource.data).affectedKeys().hasOnly(['claps']) &&  // Only claps changed
        request.resource.data.claps is number;  // Must be a number
      allow create, delete: if false;
    }
    
    // Simplified rules for project claps
    match /projectClaps/{projectId} {
      allow read: if true;
      allow write: if true;
    }
    
    match /skills/{document} {
      allow read: if true;
      allow write: if false;
    }

    match /upskilling/{document} {
      allow read: if true;
      allow write: if false;
    }

    match /graduation/{document} {
      allow read: if true;
      allow write: if false;
    }
    
    match /testimonials/{document} {
      allow read: if true;
      allow write: if false;
    }
    
    match /timeline/{document} {
      allow read: if true;
      allow write: if false;
    }
    
    match /about/{document} {
      allow read: if true;
      allow write: if false;
    }
    
    match /contact/{document} {
      allow read: if false;
      allow create: if
        request.resource.data.firstName is string &&
        request.resource.data.firstName.size() > 0 &&
        request.resource.data.email is string &&
        request.resource.data.email.matches('^[^@]+@[^@]+\\.[^@]+$') &&
        request.resource.data.message is string &&
        request.resource.data.message.size() > 0 &&
        (!('lastName' in request.resource.data) || request.resource.data.lastName is string) &&
        (!('projectType' in request.resource.data) || request.resource.data.projectType is string) &&
        request.resource.data.createdAt is timestamp &&
        request.time == request.resource.data.createdAt;
      allow update, delete: if false;
    }
    
    match /hero/{document} {
      allow read: if true;
      allow write: if false;
    }
    
    match /stats/{document} {
      allow read: if true;
      allow write: if false;
    }
    
    match /certificates/{document} {
      allow read: if true;
      allow write: if false;
    }
    
    match /affiliations/{document} {
      allow read: if true;
      allow write: if false;
    }
    
    match /awards/{document} {
      allow read: if true;
      allow write: if false;
    }
    
    match /publications/{document} {
      allow read: if true;
      allow write: if false;
    }
    
    // Default rule - deny everything else
    match /{document=**} {
      allow read: if false;
      allow write: if false;
    }
  }
}